training:
  steps:
    #
    # S1
    #
    - convert:
        binpack: official-stockfish/master-binpacks/fishpack32.binpack
        checkpoint2nnue:
          - --features=HalfKAv2_hm^
          - --l1=3072
          - --ft_compression=leb128
        optimize:
          - --features=HalfKAv2_hm
          - --l1=3072
          - --ft_optimize_count=100000
          - --ft_optimize
          - --ft_compression=leb128
      run:
        binpacks:
          - vondele/rescored/test80-2023-06-jun-2tb7p.min-v2-rescore_SF_n5000.binpack
        max_epochs: 800
        repetitions: 3
        other_options:
          - --batch-size=16384
          - --features=HalfKAv2_hm^
          - --l1=3072
          - --lr=4.375e-4
          - --gamma=0.995
          - --start-lambda=1.0
          - --end-lambda=0.75
          - --in-scaling=260
          - --in-offset=230
          - --out-scaling=365
          - --out-offset=280
          - --random-fen-skipping=10
          - --early-fen-skipping=12
        resume: none
      trainer:
        owner: official-stockfish
        sha: ba499f2819dab17ec1784ea6522ee004ff32fd57
    #
    # S2
    #
    - convert:
        binpack: official-stockfish/master-binpacks/fishpack32.binpack
        checkpoint2nnue:
          - --features=HalfKAv2_hm^
          - --l1=3072
          - --ft_compression=leb128
        optimize:
          - --features=HalfKAv2_hm
          - --l1=3072
          - --ft_optimize_count=100000
          - --ft_optimize
          - --ft_compression=leb128
      run:
        binpacks:
          - vondele/rescored/test80-2023-06-jun-2tb7p.min-v2-rescore_SF_n5000.binpack
        max_epochs: 800
        repetitions: 3
        other_options:
          - --batch-size=16384
          - --features=HalfKAv2_hm^
          - --l1=3072
          - --lr=0.0010783148702050778
          - --gamma=0.994446435229841
          - --pow-exp=2.442037790427722
          - --qp-asymmetry=0.15795949371005746
          - --start-lambda=0.8460635942002347
          - --end-lambda=0.7490913625693039
          - --in-scaling=260
          - --in-offset=230
          - --out-scaling=365
          - --out-offset=280
          - --random-fen-skipping=10
          - --early-fen-skipping=28
        resume: previous_model
      trainer:
        owner: official-stockfish
        sha: ba499f2819dab17ec1784ea6522ee004ff32fd57
#
# Final testing stage using fastchess
#
testing:
  steps: all
  reference:
    code:
      owner: official-stockfish
      sha: adfddd2c984fac5f2ac02d87575af821ec118fa8
  testing:
    code:
      owner: official-stockfish
      sha: adfddd2c984fac5f2ac02d87575af821ec118fa8
  fastchess:
    code:
      owner: Disservin
      sha: 66cac47f06dc1a09d3d1865cdbf560a7814f82ea
    options:
       tc: 10+0.1
       hash: 16
       max_rounds: 20000
#    sprt:
#       nElo_interval_midpoint: -10
#       nElo_interval_width: 2
