training:
  step:
    convert:
      binpack: official-stockfish/master-binpacks/fishpack32.binpack
      checkpoint2nnue:
        - --features=HalfKAv2_hm^
        - --l1=128
        - --ft_compression=leb128
      optimize:
        - --features=HalfKAv2_hm
        - --l1=128
        - --ft_optimize_count=100000
        - --ft_optimize
        - --ft_compression=leb128
    datasets:
      - hf:
          owner: official-stockfish
          repo: master-binpacks
      - hf:
          owner: linrock
          repo: dual-nnue
      - hf:
          owner: linrock
          repo: test80-2022
      - hf:
          owner: linrock
          repo: test80-2023
      - hf:
          owner: linrock
          repo: test80-2024
    run:
      binpacks:
        - linrock/dual-nnue/hse-v1/dfrc99-16tb7p-eval-filt-v2.min.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/leela96-filt-v2.min.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test60-novdec2021-12tb7p-filter-v6-dd.min-mar2023.unmin.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test77-nov2021-2tb7p.no-db.min.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test77-dec2021-16tb7p.no-db.min.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test77-jan2022-2tb7p.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test78-jantomay2022-16tb7p-filter-v6-dd.min-mar2023.unmin.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test78-juntosep2022-16tb7p-filter-v6-dd.min-mar2023.unmin.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test79-apr2022-16tb7p.min.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test79-may2022-16tb7p-filter-v6-dd.min-mar2023.unmin.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test80-apr2022-16tb7p.min.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test80-may2022-16tb7p.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test80-jun2022-16tb7p-filter-v6-dd.min-mar2023.unmin.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test80-jul2022-16tb7p.v6-dd.min.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test80-sep2022-16tb7p-filter-v6-dd.min-mar2023.unmin.high-simple-eval-1k.min-v2.binpack
        - linrock/dual-nnue/hse-v1/test80-nov2022-16tb7p-v6-dd.min.high-simple-eval-1k.min-v2.binpack
        - linrock/test80-2022/test80-2022-08-aug-16tb7p.v6-dd.min.binpack
        - linrock/test80-2022/test80-2022-10-oct-16tb7p.v6-dd.binpack
        - linrock/test80-2022/test80-2022-12-dec-16tb7p.min.binpack
        - linrock/test80-2023/test80-2023-01-jan-16tb7p.v6-sk20.min.binpack
        - linrock/test80-2023/test80-2023-02-feb-16tb7p.v6-dd.min.binpack
        - linrock/test80-2023/test80-2023-03-mar-2tb7p.v6-sk16.min.binpack
        - linrock/test80-2023/test80-2023-04-apr-2tb7p.v6-sk16.min.binpack
        - linrock/test80-2023/test80-2023-05-may-2tb7p.v6.min.binpack
        - linrock/test80-2023/test80-2023-06-jun-2tb7p.min-v2.binpack
        - linrock/test80-2023/test80-2023-07-jul-2tb7p.min-v2.binpack
        - linrock/test80-2023/test80-2023-08-aug-2tb7p.v6.min.binpack
        - linrock/test80-2023/test80-2023-09-sep-2tb7p.binpack
        - linrock/test80-2023/test80-2023-10-oct-2tb7p.binpack
        - linrock/test80-2023/test80-2023-11-nov-2tb7p.min-v2.binpack
        - linrock/test80-2023/test80-2023-12-dec-2tb7p.min-v2.binpack
        - linrock/test80-2024/test80-2024-01-jan-2tb7p.min-v2.v6.binpack
        - linrock/test80-2024/test80-2024-02-feb-2tb7p.min-v2.v6.binpack
        - linrock/test80-2024/test80-2024-03-mar-2tb7p.min-v2.v6.binpack
      max_epochs: 400
      other_options:
        - --batch-size=16384
        - --features=HalfKAv2_hm^
        - --l1=128
        - --no-wld-fen-skipping
        - --start-lambda=1.0
        - --end-lambda=0.6992605384421289
        - --gamma=0.9942746303116422
        - --lr=0.0012181558724738395
        - --in-scaling=317.54982869522763
        - --out-scaling=379.8040378799748
        - --in-offset=269.50654301142134
        - --out-offset=253.51483568025657
        - --pow-exp=2.4829519732155125
        - --random-fen-skipping=3
        - --simple-eval-skipping=931
        - --compile-backend=cudagraphs
      resume: none
    trainer:
      owner: official-stockfish
      sha: ba499f2819dab17ec1784ea6522ee004ff32fd57
#
# Final testing stage using fastchess
#
testing:
  reference:
    code:
      owner: official-stockfish
      sha: 64e8e1b247367018ebbce15f0d7cf5a56c7eaf56
  testing:
    code:
      owner: official-stockfish
      sha: 64e8e1b247367018ebbce15f0d7cf5a56c7eaf56
  fastchess:
    code:
      owner: Disservin
      sha: 7676d4961518a7a0156bcd200149acc8c921f977
    options:
       tc: 10+0.1
       hash: 16
       evalfile: small
    sprt:
       # midpoint will be the target to reach, relative to reference, to have a passing CI
       nElo_interval_midpoint: -0.75
       nElo_interval_width: 2
       max_rounds: 160000
